name: RTSP → GitHub Pages
on:
  schedule:
    - cron: '*/3 * * * *'          # ทุก 3 นาที
  workflow_dispatch:               # กดรันด้วยมือ
jobs:
  stream:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install static ffmpeg
        run: |
          curl -L https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz | tar xJ
          sudo mv ffmpeg-*/ffmpeg /usr/local/bin/ffmpeg

      - name: Build HLS
        run: |
          mkdir -p stream1
          ffmpeg -rtsp_transport tcp \
            -i rtsp://admin:hs8tv_2504@ramrome.thddns.net:3380/stream1 \
            -c:v copy -c:a copy -hls_time 3 -hls_list_size 6 \
            -hls_flags delete_segments -f hls stream1/playlist.m3u8 \
            -t 110 || true

      - name: Commit & push
        run: |
          git config user.name "bot"
          git config user.email "bot@users.noreply.github.com"
          git add stream1
          git diff --quiet && git diff --staged --quiet || (git commit -m "update stream" && git push)
