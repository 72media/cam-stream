name: RTSP → GitHub Pages
on:
  schedule:
    - cron: '*/3 * * * *'          # ทุก 3 นาที
  workflow_dispatch:               # กดรันด้วยมือ
jobs:
  stream:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run LiveKit OSS + ffmpeg
        run: |
          mkdir -p stream1
          docker run --rm -d -p 7880:7880 -p 7881:7881 livekit/livekit-server --dev
          sleep 5
          ffmpeg -rtsp_transport tcp -i rtsp://admin:hs8tv_2504@ramrome.thddns.net:3380/stream1 -c:v copy -c:a copy -hls_time 3 -hls_list_size 6 -hls_flags delete_segments -f hls stream1/playlist.m3u8 -t 110 || true
          git config user.name "bot"
          git config user.email "bot@users.noreply.github.com"
          git add stream1
          git diff --quiet && git diff --staged --quiet || (git commit -m "update stream" && git push)
